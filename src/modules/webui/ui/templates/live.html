{% extends "base.html" %}
{% block title %}
Live Data
{% endblock %}

{% block head %}
<link href="/css/Chart.min.css" rel="stylesheet"/>
<script src="/js/Chart.bundle.min.js" type="text/javascript"></script>
<script src="/js/chartjs-plugin-streaming.min.js" type="text/javascript"></script>
<script src="/js/data_charts.js" type="text/javascript"></script>
<script src="/js/chartjs-plugin-colorschemes.min.js" type="text/javascript"></script>
{% endblock %}

{% block body %}
<body>
    <div class="container-fluid text-center">
        <h1>Live Data View</h1>
        <div class="container justify-content-center">
            
        <!-- Charts -->
        <div id="chart_div" class="container" style="width:75%">
            <!-- Visibility Checkboxes -->
            <div id="checkbox_div"></div>
            
            <br>

            <!-- Pause Button-->
            <p>
                <button id="pause-scroll" class="btn btn-primary">Pause</button>
            </p>

        </div>



        <!-- <div class="container" style="width:75%">

            <div class="row">
                <div class="col-lg-auto">
                    <canvas id="gas_chart" width="400" height="400"></canvas>
                </div>
                <div class="col-lg-auto">
                    <canvas class="col-md-auto" id="pressure_chart" width="400" height="400"></canvas>
                </div>
            </div>
        </div> -->
    </div>

    
    <!-- Live Data Processing -->
    <script type="text/javascript">
        var live_data = {};

        setInterval(getLiveData, 5000);

        // Request New Data From API
        function getLiveData() {
            const url = "/api/";  
            fetch(url)
                .then((resp) => resp.json())
                .then(function(new_live_data) {
                    live_data = new_live_data;   
                })
                .catch(function(error) {
                    console.log(error);
                });
        }

        // Pause Chart Scroll On Button Press
        var pause_btn = document.getElementById('pause-scroll');
        pause_btn.addEventListener('click', function() {
            charts.forEach(function(chart){
                // Play
                if (chart.config.options.plugins.streaming.pause === true) {
                    chart.config.options.plugins.streaming.pause = false;
                    chart.enabled = true;
                    pause_btn.innerText = "Pause";
                }
                // Pause
                else {
                    chart.config.options.plugins.streaming.pause = true;
                    chart.enabled = false;
                    pause_btn.innerText = "Play";
                }
                chart.update();
            })
		});

        // Initialize Charts
        initCharts();
        
    </script>

</body>
{% endblock %}